{"version":3,"sources":["uni-app:///main.js","webpack:////Users/hupeng/hupeng/java/yshopb2c-open/yshopmall/yshop-mall-uniapp/pages/order/OrderSubmission/index.vue?4051","webpack:////Users/hupeng/hupeng/java/yshopb2c-open/yshopmall/yshop-mall-uniapp/pages/order/OrderSubmission/index.vue?42bb","webpack:////Users/hupeng/hupeng/java/yshopb2c-open/yshopmall/yshop-mall-uniapp/pages/order/OrderSubmission/index.vue?9618","webpack:////Users/hupeng/hupeng/java/yshopb2c-open/yshopmall/yshop-mall-uniapp/pages/order/OrderSubmission/index.vue?8ffc","uni-app:///pages/order/OrderSubmission/index.vue","webpack:////Users/hupeng/hupeng/java/yshopb2c-open/yshopmall/yshop-mall-uniapp/pages/order/OrderSubmission/index.vue?b639","webpack:////Users/hupeng/hupeng/java/yshopb2c-open/yshopmall/yshop-mall-uniapp/pages/order/OrderSubmission/index.vue?88cd"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","_isWeixin","name","components","OrderGoods","CouponListWindow","AddressWindow","props","data","offlinePayStatus","from","deduction","enableIntegral","enableIntegralNum","isWeixin","pinkId","active","showCoupon","showAddress","addressInfo","couponId","orderGroupInfo","priceGroup","usableCoupon","addressLoaded","useIntegral","orderPrice","payPrice","mark","systemStore","shipping_type","contacts","contactsTel","storeSelfMention","cartid","isIntegral","computed","watch","onLoad","that","console","methods","showStoreList","path","addressType","uni","title","icon","duration","changeUseIntegral","computedPrice","addressId","query","id","getCartInfo","cartIds","then","catch","addressTap","addressRedirect","couponTap","changeCoupon","couponTitle","payItem","changeAddress","createOrder","realName","phone","payType","seckillId","combinationId","shippingType","storeId","handleOrderPayResults"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,cAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA8H;AAC9H;AACyD;AACL;AACsC;;;AAG1F;AACyN;AACzN,gBAAgB,iNAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,4FAAM;AACR,EAAE,qGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,gGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAg3B,CAAgB,myBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;AC8Pp4B;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAEA;EACAC;AAAA,eACA;EACAC;EACAC;IACAC;IACAC;IACAC;EACA;EACAC;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;QACAC;MACA;MACAC;MACAC;MACAC;MACAC;QACAC;MACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC;EACAC;IACAZ;MACA;IACA;IACAK;MACA;IACA;EACA;EACAQ;IAGA;IAEA;IACA;IACAC;IAEAC;IACA;MACAD;IACA;IACA;IACA;IACA;MACA;IACA;IACA;MACAA;MACAC;IACA;EACA;EACAC;IACAC;MACA;MACA;QACAC;MACA;IACA;IACAC;MACA;QACAC;UACAC;UACAC;UACAC;QACA;QACA;MACA;MACAR;MACA;IACA;IACAS;MACA;MACA;QACA;MACA;MACA;IACA;IACA;IACAC;MAAA;MACA;MACA;QACAC;QACA1B;QACAL;QACAU;MACA;QACA;QACA;UACA;YACAa;YACAS;cACAC;YACA;UACA;QACA;UACA;QACA;MACA;IACA;IACAC;MAAA;MACA;MACA;MACA;QACAC;MACA;MACA;QACAV;UACAC;UACAC;UACAC;QACA;QACA;MACA;MACA,sCACAQ;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;MACA,GACAC;QACAjB;QACAK;UACAC;UACAC;UACAC;QACA;MACA;IACA;IACAU;MACA;MACA;QACA;QACA;MACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;QACA;UACAC;UACAT;QACA;MACA;QACA;MACA;MACA;IACA;IACAU;MACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MAAA;MACA;QACA;QACA;UACApB;YACAC;YACAC;YACAC;UACA;UACA;QACA;QACA;MACA;MACA;MACA;QACAH;UACAC;UACAC;UACAC;QACA;QACA;MACA;MACA;QACAH;UACAC;UACAC;UACAC;QACA;QACA;MACA;MAEA;QACA;UACAH;YACAC;YACAC;YACAC;UACA;UACA;QACA;QAEA;UACAH;YACAC;YACAC;YACAC;UACA;UACA;QACA;QACA;UACAH;YACAC;YACAC;YACAC;UACA;UACA;QACA;MACA;MAEAH;QACAC;MACA;MACA;MACA;QACApC;MACA;MACA8B;;MAGA;;MAEA;QACA0B;QACAC;QACAhB;QACA1B;QACAL;QACAgD;QACArD;QACAsD;QACAC;QACA5D;QACAkB;QACA2C;QACAC;MAAA,GACA9D,MACA,CACA8C;QACAX;QACA4B;MACA,GACAhB;QACA;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;ACliBA;AAAA;AAAA;AAAA;AAA2mD,CAAgB,25CAAG,EAAC,C;;;;;;;;;;;ACA/nD;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/order/OrderSubmission/index.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/order/OrderSubmission/index.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=b2c1209a&scoped=true&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=b2c1209a&scoped=true&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"b2c1209a\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/order/OrderSubmission/index.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=b2c1209a&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","<template>\r\n  <view class=\"order-submission\">\r\n    <view class=\"allAddress\" :style=\"systemStore ? '' : 'padding-top: 0.2*100rpx'\">\r\n      <view class=\"nav acea-row\">\r\n        <view class=\"item font-color-red\" :class=\"shipping_type === 0 ? 'on' : 'on2'\" @click=\"addressType(0)\" v-if=\"systemStore\"></view>\r\n        <view  class=\"item font-color-red\" :class=\"shipping_type === 1 ? 'on' : 'on2'\" @click=\"addressType(1)\" v-if=\"storeSelfMention != 2 && systemStore && !isIntegral\"></view>\r\n      </view>\r\n      <view class=\"address acea-row row-between-wrapper\" v-if=\"shipping_type === 0\" @click=\"addressTap\">\r\n        <view class=\"addressCon\" v-if=\"addressInfo.realName\">\r\n          <view class=\"name\">\r\n            {{ addressInfo.realName }}\r\n            <text class=\"phone\">{{ addressInfo.phone }}</text>\r\n          </view>\r\n          <view>\r\n            <text class=\"default font-color-red\" v-if=\"addressInfo.isDefault\">[默认]</text>\r\n            {{ addressInfo.province }}{{ addressInfo.city }}{{ addressInfo.district }}{{ addressInfo.detail }}\r\n          </view>\r\n        </view>\r\n        <view class=\"addressCon\" v-else>\r\n          <view class=\"setaddress\">设置收货地址</view>\r\n        </view>\r\n        <view class=\"iconfont icon-jiantou\"></view>\r\n      </view>\r\n      <view class=\"address acea-row row-between-wrapper\" v-if=\"shipping_type === 1\" @click=\"showStoreList\">\r\n        <view class=\"addressCon\" v-if=\"storeItems\">\r\n          <view class=\"name\">\r\n            {{ storeItems.name }}\r\n            <span class=\"phone\">{{ storeItems.phone }}</span>\r\n          </view>\r\n          <view>{{ storeItems.address }}</view>\r\n        </view>\r\n        <view class=\"addressCon\" v-else>\r\n          <view class=\"name\">\r\n            {{ systemStore.name }}\r\n            <span class=\"phone\">{{ systemStore.phone }}</span>\r\n          </view>\r\n          <view>{{ systemStore.address }}</view>\r\n        </view>\r\n        <view class=\"iconfont icon-jiantou\"></view>\r\n      </view>\r\n      <view class=\"line\">\r\n        <image :src=\"`${$VUE_APP_RESOURCES_URL}/images/line.jpg`\" />\r\n      </view>\r\n    </view>\r\n    <OrderGoods :evaluate=\"0\" :isIntegral=\"isIntegral\" :cartInfo=\"orderGroupInfo.cartInfo\"></OrderGoods>\r\n    <view class=\"wrapper\">\r\n      <view class=\"item acea-row row-between-wrapper\" @click=\"couponTap\" v-if=\"deduction === false && !isIntegral\">\r\n        <view>优惠券</view>\r\n        <view class=\"discount\">\r\n          {{ usableCoupon.couponTitle || '请选择' }}\r\n          <text class=\"iconfont icon-jiantou\"></text>\r\n        </view>\r\n      </view>\r\n      <view class=\"item acea-row row-between-wrapper\" v-if=\"!isIntegral && deduction === false && enableIntegral === true\">\r\n        <view>积分抵扣</view>\r\n        <view class=\"discount\">\r\n          <view class=\"select-btn\">\r\n            <view class=\"checkbox-wrapper\">\r\n              <!-- <input type=\"checkbox\" v-model=\"useIntegral\" @click=\"changeUseIntegral\"/> -->\r\n              <checkbox-group @change=\"changeUseIntegral\">\r\n                <label class=\"well-check\">\r\n                  <text class=\"integral\">\r\n                    当前积分\r\n                    <text class=\"num font-color-red\">{{ userInfo.integral || 0 }}</text>\r\n                  </text>\r\n                  <checkbox value=\"true\" :checked=\"useIntegral ? true : false\"></checkbox>\r\n                </label>\r\n              </checkbox-group>\r\n            </view>\r\n          </view>\r\n        </view>\r\n      </view>\r\n      <view class=\"item acea-row row-between-wrapper\" v-if=\"shipping_type === 0\">\r\n        <view>快递费用</view>\r\n        <view class=\"discount\">\r\n          {{ orderPrice.payPostage > 0 ? orderPrice.payPostage : '免运费' }}\r\n        </view>\r\n      </view>\r\n      <view v-if=\"shipping_type === 1\">\r\n        <view class=\"item acea-row row-between-wrapper\">\r\n          <view>联系人</view>\r\n          <view class=\"discount\">\r\n            <input type=\"text\" placeholder=\"请填写您的联系姓名\" v-model=\"contacts\" />\r\n          </view>\r\n        </view>\r\n        <view class=\"item acea-row row-between-wrapper\">\r\n          <view>联系电话</view>\r\n          <view class=\"discount\">\r\n            <input type=\"text\" placeholder=\"请填写您的联系电话\" v-model=\"contactsTel\" />\r\n          </view>\r\n        </view>\r\n      </view>\r\n      <view class=\"item\">\r\n        <view>备注信息（150字以内）</view>\r\n        <textarea v-model=\"mark\"></textarea>\r\n      </view>\r\n    </view>\r\n    <view class=\"wrapper\">\r\n      <view class=\"item\">\r\n        <view>支付方式</view>\r\n        <view class=\"list\">\r\n          <view class=\"payItem acea-row row-middle\" v-if=\"!isIntegral\" :class=\"active === 'weixin' ? 'on' : ''\" @click=\"payItem('weixin')\" v-show=\"isWeixin\">\r\n            <view class=\"name acea-row row-center-wrapper\"> <view class=\"iconfont icon-weixin2\" :class=\"active === 'weixin' ? 'bounceIn' : ''\"></view>微信支付 </view>\r\n            <view class=\"tip\">微信快捷支付</view>\r\n          </view>\r\n          <view class=\"payItem acea-row row-middle\" v-if=\"!isIntegral\" :class=\"active === 'weixin' ? 'on' : ''\" @click=\"payItem('weixin')\" v-show=\"!isWeixin\">\r\n            <view class=\"name acea-row row-center-wrapper\"> <view class=\"iconfont icon-weixin2\" :class=\"active === 'weixin' ? 'bounceIn' : ''\"></view>微信支付 </view>\r\n            <view class=\"tip\">微信快捷支付</view>\r\n          </view>\r\n          <view class=\"payItem acea-row row-middle\" v-if=\"!isIntegral\" :class=\"active === 'yue' ? 'on' : ''\" @click=\"payItem('yue')\">\r\n            <view class=\"name acea-row row-center-wrapper\"> <view class=\"iconfont icon-icon-test\" :class=\"active === 'yue' ? 'bounceIn' : ''\"></view>余额支付 </view>\r\n            <view class=\"tip\">可用余额：{{ userInfo.nowMoney || 0 }}</view>\r\n          </view>\r\n          <view class=\"payItem acea-row row-middle\" v-if=\"isIntegral\" :class=\"active === 'integral' ? 'on' : ''\" @click=\"payItem('integral')\">\r\n            <view class=\"name acea-row row-center-wrapper\"> <view class=\"iconfont icon-icon-test\" :class=\"active === 'integral' ? 'bounceIn' : ''\"></view>积分支付 </view>\r\n            <view class=\"tip\">可用积分：{{ userInfo.integral || 0 }}</view>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n    <view class=\"moneyList\">\r\n      <view class=\"item acea-row row-between-wrapper\" v-if=\"orderPrice.totalPrice !== undefined\">\r\n        <view>商品总价：</view>\r\n        <view class=\"money\" v-if=\"!isIntegral\">￥{{ orderPrice.totalPrice }}</view>\r\n        <view class=\"money\" v-if=\"isIntegral\">{{ orderPrice.payIntegral }}积分</view>\r\n      </view>\r\n      <view class=\"item acea-row row-between-wrapper\" v-if=\"orderPrice.payPostage > 0 && !isIntegral\">\r\n        <view>运费：</view>\r\n        <view class=\"money\">￥{{ orderPrice.payPostage }}</view>\r\n      </view>\r\n      <view class=\"item acea-row row-between-wrapper\" v-if=\"orderPrice.couponPrice > 0 && !isIntegral\">\r\n        <view>优惠券抵扣：</view>\r\n        <view class=\"money\">-￥{{ orderPrice.couponPrice }}</view>\r\n      </view>\r\n      <view class=\"item acea-row row-between-wrapper\" v-if=\"orderPrice.deductionPrice > 0 && !isIntegral\">\r\n        <view>积分抵扣：</view>\r\n        <view class=\"money\">-￥{{ orderPrice.deductionPrice }}</view>\r\n      </view>\r\n    </view>\r\n    <view style=\"height: 120rpx\"></view>\r\n    <view class=\"footer acea-row row-between-wrapper\">\r\n      <view>\r\n        合计:\r\n        <text class=\"font-color-red\" v-if=\"!isIntegral\">￥{{ orderPrice.payPrice }}</text>\r\n        <text class=\"font-color-red\" v-if=\"isIntegral\">{{ orderPrice.payIntegral }}积分</text>\r\n      </view>\r\n      <view class=\"settlement\" @click=\"createOrder\">立即结算</view>\r\n    </view>\r\n    <CouponListWindow v-on:couponchange=\"changecoupon($event)\" v-model=\"showCoupon\" :price=\"orderPrice.totalPrice\" :checked=\"usableCoupon.id\" @checked=\"changeCoupon\" :cartid=\"cartid\"></CouponListWindow>\r\n    <AddressWindow @checked=\"changeAddress\" @redirect=\"addressRedirect\" v-model=\"showAddress\" :checked=\"addressInfo.id\" ref=\"mychild\"></AddressWindow>\r\n  </view>\r\n</template>\r\n<style scoped lang=\"less\">\r\n.order-submission .wrapper .shipping select {\r\n  color: #999;\r\n  padding-right: 0.15 * 100rpx;\r\n}\r\n\r\n.order-submission .wrapper .shipping .iconfont {\r\n  font-size: 0.3 * 100rpx;\r\n  color: #515151;\r\n}\r\n\r\n.order-submission .allAddress {\r\n  width: 100%;\r\n  background-image: linear-gradient(to bottom, #eb3729 0%, #eb3729 100%);\r\n  background-image: -webkit-linear-gradient(to bottom, #eb3729 0%, #eb3729 100%);\r\n  background-image: -moz-linear-gradient(to bottom, #eb3729 0%, #eb3729 100%);\r\n  padding-top: 1 * 100rpx;\r\n}\r\n\r\n.order-submission .allAddress .nav {\r\n  margin: 0 auto;\r\n  padding: 0 30rpx;\r\n  width: 100%;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.order-submission .allAddress .nav .item {\r\n  flex: 1;\r\n  position: relative;\r\n}\r\n\r\n.order-submission .allAddress .nav .item.on {\r\n  position: relative;\r\n}\r\n\r\n.order-submission .allAddress .nav .item.on:before {\r\n  position: absolute;\r\n  bottom: 0;\r\n  content: '快递配送';\r\n  font-size: 0.28 * 100rpx;\r\n  display: block;\r\n  height: 0;\r\n  left: 0;\r\n  right: 0;\r\n  border-width: 0.4 * 100rpx;\r\n  border-style: solid;\r\n  border-color: #fff;\r\n  z-index: 9;\r\n  text-align: center;\r\n  line-height: 0.14 * 100rpx;\r\n}\r\n\r\n.order-submission .allAddress .nav .item:nth-of-type(2).on:before {\r\n  content: '到店自提';\r\n  border-width: 0.4 * 100rpx;\r\n}\r\n\r\n.order-submission .allAddress .nav .item.on2 {\r\n  position: relative;\r\n}\r\n\r\n.order-submission .allAddress .nav .item.on2:before {\r\n  position: absolute;\r\n  bottom: 0;\r\n  content: '到店自提';\r\n  font-size: 0.28 * 100rpx;\r\n  display: block;\r\n  height: 0;\r\n  left: 0;\r\n  right: 0;\r\n  border-width: 0.4 * 100rpx;\r\n  border-style: solid;\r\n  border-color: #d5e6e6;\r\n  text-align: center;\r\n  line-height: 0.14 * 100rpx;\r\n}\r\n\r\n.order-submission .allAddress .nav .item:nth-of-type(1).on2:before {\r\n  content: '快递配送';\r\n  border-width: 0.4 * 100rpx;\r\n}\r\n\r\n.order-submission .allAddress .address {\r\n  width: 6.91 * 100rpx;\r\n  height: 1.5 * 100rpx;\r\n  margin: 0 auto;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.order-submission .allAddress .line {\r\n  width: 7.1 * 100rpx;\r\n  margin: 0 auto;\r\n}\r\n\r\n.order-submission .wrapper .item .discount input::placeholder {\r\n  color: #ccc;\r\n}\r\n</style>\r\n<script>\r\nimport OrderGoods from '@/components/OrderGoods'\r\nimport CouponListWindow from '@/components/CouponListWindow'\r\nimport AddressWindow from '@/components/AddressWindow'\r\nimport { postOrderConfirm, postOrderComputed, createOrder } from '@/api/order'\r\nimport { mapGetters } from 'vuex'\r\nimport { handleOrderPayResults, subscribeMessage } from '@/libs/order'\r\nimport { weappPay } from '@/libs/wechat'\r\nimport { isWeixin, handleErrorMessage } from '@/utils'\r\n\r\nconst NAME = 'OrderSubmission',\r\n  _isWeixin = isWeixin()\r\nexport default {\r\n  name: NAME,\r\n  components: {\r\n    OrderGoods,\r\n    CouponListWindow,\r\n    AddressWindow,\r\n  },\r\n  props: {},\r\n  data: function() {\r\n    return {\r\n      offlinePayStatus: 2,\r\n      from: this.$deviceType,\r\n      deduction: true,\r\n      enableIntegral: true,\r\n      enableIntegralNum: 0,\r\n      isWeixin: _isWeixin,\r\n      pinkId: 0,\r\n      active: _isWeixin ? 'weixin' : 'yue',\r\n      showCoupon: false,\r\n      showAddress: false,\r\n      addressInfo: {},\r\n      couponId: 0,\r\n      orderGroupInfo: {\r\n        priceGroup: {},\r\n      },\r\n      usableCoupon: {},\r\n      addressLoaded: false,\r\n      useIntegral: false,\r\n      orderPrice: {\r\n        payPrice: '计算中',\r\n      },\r\n      mark: '',\r\n      systemStore: {},\r\n      shipping_type: 0,\r\n      contacts: '',\r\n      contactsTel: '',\r\n      storeSelfMention: 0,\r\n      cartid: '',\r\n      isIntegral: false,\r\n    }\r\n  },\r\n  computed: mapGetters(['userInfo', 'storeItems']),\r\n  watch: {\r\n    useIntegral() {\r\n      this.computedPrice()\r\n    },\r\n    shipping_type() {\r\n      this.computedPrice()\r\n    },\r\n  },\r\n  onLoad: function() {\n  // #ifdef MP-WEIXIN\n   \n   subscribeMessage()\n   // #endif\r\n    let that = this\r\n    this.$store.dispatch('getUser', true)\r\n    that.getCartInfo()\r\n\r\n    console.log(that.$yroute)\r\n    if (that.$yroute.query.pinkid !== undefined) {\r\n      that.pinkId = that.$yroute.query.pinkid\r\n    }\r\n    this.isIntegral = that.$yroute.query.isIntegral == 'true'\r\n    this.useIntegral = this.isIntegral\r\n    if (this.isIntegral) {\r\n      this.active = 'integral'\r\n    }\r\n    if (that.$yroute.query.id !== undefined) {\r\n      that.cartid = that.$yroute.query.id\r\n      console.log(that.cartid)\r\n    }\r\n  },\r\n  methods: {\r\n    showStoreList() {\r\n      this.$store.commit('get_to', 'orders')\r\n      this.$yrouter.push({\r\n        path: '/pages/shop/StoreList/index',\r\n      })\r\n    },\r\n    addressType: function(index) {\r\n      if (index && !this.systemStore.id) {\r\n        uni.showToast({\r\n          title: '暂无门店信息，您无法选择到店自提！',\r\n          icon: 'none',\r\n          duration: 2000,\r\n        })\r\n        return\r\n      }\r\n      console.log(this)\r\n      this.shipping_type = index\r\n    },\r\n    changeUseIntegral: function(e) {\r\n      // this.computedPrice();\r\n      if (this.isIntegral) {\r\n        return\r\n      }\r\n      this.useIntegral = e.mp.detail.value[0]\r\n    },\r\n\t// 计算商品价格\r\n    computedPrice() {\r\n      let shipping_type = this.shipping_type\r\n      postOrderComputed(this.orderGroupInfo.orderKey, {\r\n        addressId: this.addressInfo.id,\r\n        useIntegral: this.useIntegral ? 1 : 0,\r\n        couponId: this.usableCoupon.id || 0,\r\n        shipping_type: parseInt(shipping_type) + 1,\r\n      }).then(res => {\r\n        const data = res.data\r\n        if (data.status === 'EXTEND_ORDER') {\r\n          this.$yrouter.replace({\r\n            path: '/pages/order/OrderDetails/index',\r\n            query: {\r\n              id: data.result.orderId,\r\n            },\r\n          })\r\n        } else {\r\n          this.orderPrice = data.result\r\n        }\r\n      })\r\n    },\r\n    getCartInfo() {\r\n      let cartIds = this.$yroute.query.id\r\n\t  // 拼团id\r\n\t  if (this.$yroute.query.pinkId) {\r\n\t\t cartIds = this.$yroute.query.pinkId\r\n\t  }\r\n      if (!cartIds) {\r\n        uni.showToast({\r\n          title: '参数有误',\r\n          icon: 'none',\r\n          duration: 2000,\r\n        })\r\n        return this.$yrouter.back()\r\n      }\r\n      postOrderConfirm(cartIds)\r\n        .then(res => {\r\n          this.offlinePayStatus = res.data.offline_pay_status\r\n          this.orderGroupInfo = res.data\r\n          this.deduction = res.data.deduction\r\n          this.usableCoupon = res.data.usableCoupon || {}\r\n          this.addressInfo = res.data.addressInfo || {}\r\n          // 用来显示到店自提的店铺地址\r\n          this.systemStore = res.data.systemStore || {}\r\n          this.storeSelfMention = res.data.storeSelfMention\r\n          this.computedPrice()\r\n        })\r\n        .catch((error) => {\r\n          console.log(error)\r\n          uni.showToast({\r\n            title: '加载订单数据失败',\r\n            icon: 'none',\r\n            duration: 2000,\r\n          })\r\n        })\r\n    },\r\n    addressTap: function() {\r\n      this.showAddress = true\r\n      if (!this.addressLoaded) {\r\n        this.addressLoaded = true\r\n        this.$refs.mychild.getAddressList()\r\n      }\r\n    },\r\n    addressRedirect() {\r\n      this.addressLoaded = false\r\n      this.showAddress = false\r\n    },\r\n    couponTap: function() {\r\n      this.showCoupon = true\r\n    },\r\n    changeCoupon: function(coupon) {\r\n      if (!coupon) {\r\n        this.usableCoupon = {\r\n          couponTitle: '不使用优惠券',\r\n          id: 0,\r\n        }\r\n      } else {\r\n        this.usableCoupon = coupon\r\n      }\r\n      this.computedPrice()\r\n    },\r\n    payItem: function(index) {\r\n      this.active = index\r\n    },\r\n    changeAddress(addressInfo) {\r\n      this.addressInfo = addressInfo\r\n      this.computedPrice()\r\n    },\r\n    createOrder() {\r\n      if (this.isIntegral) {\r\n        // 积分支付\r\n        if (this.userInfo.integral < this.orderPrice.payIntegral) {\r\n          uni.showToast({\r\n            title: '积分不足',\r\n            icon: 'none',\r\n            duration: 2000,\r\n          })\r\n          return\r\n        }\r\n        this.active = 'integral'\r\n      }\r\n      let shipping_type = this.shipping_type\r\n      if (!this.isIntegral && !this.active) {\r\n        uni.showToast({\r\n          title: '请选择支付方式',\r\n          icon: 'none',\r\n          duration: 2000,\r\n        })\r\n        return\r\n      }\r\n      if (!this.addressInfo.id && !this.shipping_type) {\r\n        uni.showToast({\r\n          title: '请选择收货地址',\r\n          icon: 'none',\r\n          duration: 2000,\r\n        })\r\n        return\r\n      }\r\n\r\n      if (this.shipping_type) {\r\n        if ((this.contacts === '' || this.contactsTel === '') && this.shipping_type) {\r\n          uni.showToast({\r\n            title: '请填写联系人或联系人电话',\r\n            icon: 'none',\r\n            duration: 2000,\r\n          })\r\n          return\r\n        }\r\n\r\n        if (!/^1(3|4|5|7|8|9|6)\\d{9}$/.test(this.contactsTel)) {\r\n          uni.showToast({\r\n            title: '请填写正确的手机号',\r\n            icon: 'none',\r\n            duration: 2000,\r\n          })\r\n          return\r\n        }\r\n        if (!/^[\\u4e00-\\u9fa5\\w]{2,16}$/.test(this.contacts)) {\r\n          uni.showToast({\r\n            title: '请填写您的真实姓名',\r\n            icon: 'none',\r\n            duration: 2000,\r\n          })\r\n          return\r\n        }\r\n      }\r\n\r\n      uni.showLoading({\r\n        title: '生成订单中',\r\n      })\r\n      let from = {}\r\n      if (this.$deviceType == 'app') {\r\n        from.from = 'app'\r\n      }\r\n      console.log(this.$deviceType)\r\n      // #ifdef MP-WEIXIN\n\t  \r\n     // subscribeMessage()\r\n      // #endif\r\n      createOrder(this.orderGroupInfo.orderKey, {\r\n        realName: this.contacts,\r\n        phone: this.contactsTel,\r\n        addressId: this.addressInfo.id,\r\n        useIntegral: this.useIntegral ? 1 : 0,\r\n        couponId: this.usableCoupon.id || 0,\r\n        payType: this.active,\r\n        pinkId: this.pinkId,\r\n        seckillId: this.orderGroupInfo.seckill_id,\r\n        combinationId: this.orderGroupInfo.combination_id,\r\n        from: this.from,\r\n        mark: this.mark || '',\r\n        shippingType: parseInt(shipping_type) + 1,\r\n        storeId: this.storeItems ? this.storeItems.id : this.systemStore.id,\r\n        ...from,\r\n      })\r\n        .then(res => {\r\n          uni.hideLoading()\r\n          handleOrderPayResults.call(this, res.data, 'create', this.active)\r\n        })\r\n        .catch(err => {\r\n          handleErrorMessage(err, '创建订单失败')\r\n        })\r\n    },\r\n  },\r\n}\r\n</script>\r\n","import mod from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--10-oneOf-1-2!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-3!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-4!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--10-oneOf-1-5!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&id=b2c1209a&scoped=true&lang=less&\"; export default mod; export * from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--10-oneOf-1-2!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-3!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-4!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--10-oneOf-1-5!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&id=b2c1209a&scoped=true&lang=less&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1739765282717\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}